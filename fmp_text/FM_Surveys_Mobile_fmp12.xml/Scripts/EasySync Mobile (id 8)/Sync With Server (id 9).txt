#Sync With Server:Manages the sync process.History:2014-04-16			Tim Dietrich (timdietrich@me.com)	Initial version.2014-04-18			Tim Dietrich (timdietrich@me.com)	Reflects move to UTC time.	"Ping" process has been split into a separate script.2014-04-24			Tim Dietrich (timdietrich@me.com)	Adds support for the "deletion" phase of the sync process.2014-05-01			Tim Dietrich (timdietrich@me.com)	Reflects new delete support strategy. 	Includes call to "Sync Check," code to clean up deleted record UUIDs, etc.	Also reflects move to a single "EasySync_Payloads" layout.	Refresh Window script steps replaced with Refresh Object steps.	Minor changes to UI and status messages.2014-05-15		Tim Dietrich (timdietrich@me.com)	The last pull UTC is now captured prior to the pull itself, and only gets set if the pull	is successful. This prevents records that are in play on the servr while the payload is 	being processed on the mobile device from being excluded from future pulls.2014-10-19	Tim Dietrich (timdietrich@me.com)	Added configuration check. If no "ES" tables are setup, then the sync process is aborted.
#
#Check to see if there are ES tables configured for syncing.
Set Variable [ $sync_tables; Value:ExecuteSQL ( "SELECT * FROM FileMaker_Tables WHERE ( TableName LIKE 'ES\_%' )"; "</col>"; ¶ ) ]
If [ IsEmpty ( $sync_tables ) ]
Show Custom Dialog [ Title: "Configuration Error"; Message: "There are no \"ES\" tables configured for syncing."; Default Button: “OK”, Commit: “Yes” ]
Halt Script
End If
#
#Note the start time - both as a timestamp and UTC time.
Set Variable [ $start; Value:Get ( CurrentTimeStamp ) ]
Set Variable [ $start_utc; Value:Get ( CurrentTimeUTCMilliseconds ) ]
#
Allow User Abort [ Off ]
Set Error Capture [ On ]
#
#Display EasySync layout.
Go to Layout [ "EasySync_Payloads" ]
Set Variable [ $$EasySync_Status; Value:"EasySync firing up..." ]
Refresh Window
#
#Load EasySync settings.
Perform Script [ “EasySync Settings” ]
#
#Ping the server.
Perform Script [ “Ping Server” ]
#
#If the ping failed...
If [ Get ( ScriptResult ) = 0 ]
Go to Layout [ original layout ]
Exit Script [  ]
End If
#
#Confirm the sync.
If [ $$ask_before_sync ]
Show Custom Dialog [ Title: "Sync With Server?"; Message: "Do you really want to sync with the server?"; Default Button: “Yes”, Commit: “Yes”; Button 2: “No”, Commit: “No” ]
If [ Get ( LastMessageChoice ) = 2 ]
Go to Layout [ original layout ]
Exit Script [  ]
End If
End If
#
Set Variable [ $$EasySync_Status; Value:"Preparing to Sync..." ]
Refresh Window
//  Refresh Object [ Object Name: "easysync_status" ]
#
#Commit any unsaved changes.
If [ $$commit_before_sync ]
Commit Records/Requests[ No dialog ]
End If
#
#Prevent the user from aborting, and we'll handle errors, so suppress those...
If [ $$debug_push = 0 and $$debug_pull = 0 // Allow aborts in debug mode. ]
Allow User Abort [ Off ]
End If
Set Error Capture [ On ]
#
Set Variable [ $$EasySync_Status; Value:"EasySync is go for launch..." ]
Refresh Window
#
#If "ES_Last_Pull_UTC_Time" is not set...
If [ IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Pull_UTC_Time" ) ) ]
Set Field By Name [ "EasySync_Payloads::ES_Last_Pull_UTC_Time"; 0 ]
End If
#
#If "ES_Last_Push_UTC_Time" is not set...
If [ IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Push_UTC_Time" ) ) ]
Set Field By Name [ "EasySync_Payloads::ES_Last_Push_UTC_Time"; 0 ]
End If
#
#Push data to the server.
Perform Script [ “Push Payload” ]
#
#If we are showing successful push info, or if there was an error...
If [ ( $$show_successful_pushes = 1 ) or ( GetValue ( Get ( ScriptResult ) ; 1 ) ≠ 1 ) ]
#Show the push result to the user.
Show Custom Dialog [ Title: GetValue ( Get ( ScriptResult ) ; 2 ); Message: GetValue ( Get ( ScriptResult ) ; 3 ); Default Button: “OK”, Commit: “Yes” ]
End If
#
#If the push process was successful...
If [ GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ]
#
#If, during the ping process, it was found that the solution is out of date...
If [ $$easydeploy_suggest_upgrade ]
Show Custom Dialog [ Title: "Upgrade Solution?"; Message: "A new version of this solution is available.¶¶Would you like to upgrade now?"; Default Button: “Yes”, Commit: “Yes”; Button 2: “No”, Commit: “No” ]
If [ Get ( LastMessageChoice ) = 1 ]
Perform Script [ “Upgrade Solution” ]
Halt Script
End If
End If
#
#Update the "last push" time.
Set Field By Name [ "EasySync_Payloads::ES_Last_Push_UTC_Time"; Get ( CurrentTimeUTCMilliseconds ) ]
Commit Records/Requests[ Skip data entry validation; No dialog ]
#
#Clean up any "deleted record UUID" payload records...
Enter Find Mode [  ]
Set Field [ EasySync_Payloads::ES_Deleted_Record_UUID; "@*" ]
Perform Find [  ]
If [ Get ( FoundCount ) ]
Delete All Records[ No dialog ]
End If
#
Set Variable [ $$EasySync_Status; Value:"Pulling Data from Server..." ]
Refresh Object [ Object Name: "easysync_status" ]
#
#Log the start of the pull process.
Set Variable [ $pull_start_utc; Value:Get ( CurrentTimeUTCMilliseconds ) ]
#
#Pull data from the server.
Perform Script [ “Pull Payload” ]
#
#If the pull process was also successful...
If [ ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ) ]
#Update the "last pull" time.
Set Field By Name [ "EasySync_Payloads::ES_Last_Pull_UTC_Time"; $pull_start_utc ]
#Set a timestamp as well, for use by the UI to show the "last sync."
Set Field By Name [ "EasySync_Payloads::ES_Last_Full_Sync"; Get ( CurrentTimeStamp ) ]
Commit Records/Requests[ Skip data entry validation; No dialog ]
End If
#
#Show the pull result to the user.
If [ ( $$show_successful_pulls = 1 ) or ( GetValue ( Get ( ScriptResult ) ; 1 ) = 0 ) ]
Show Custom Dialog [ Title: GetValue ( Get ( ScriptResult ) ; 2 ); Message: GetValue ( Get ( ScriptResult ) ; 3 ); Default Button: “OK”, Commit: “Yes” ]
End If
#
#If the pull was successful, and if we are to perform a sync check...
If [ ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ) and $$perform_sync_check ]
#
#Peform a "sync check" to delete any records on the mobile device that are no longer on the server.
Perform Script [ “Sync Check” ]
#
End If
#
#Refresh UI.
Go to Layout [ original layout ]
Show All Records
Refresh Window
Set Variable [ $$EasySync_Status; Value:"" ]
Show Custom Dialog [ Title: "Sync Completed"; Message: Let ([e = Get ( CurrentTimeStamp ) - $start;e = If ( e ≤ 1 ; "Less than a second."; e )];"The sync process has completed. (Elapsed Time: " & e & ")"); Default Button: “OK”, Commit: “Yes” ]
#
Else
#
#Close the hosted file.
Close File [ “Hosted_Database” ]
#
Go to Layout [ original layout ]
#
End If


---
Script:
  includeInMenu: 'False'
  runFullAccess: 'False'
  id: '9'
  name: Sync With Server
  StepList:
    Step:
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: "#Sync With Server:\nManages the sync process.\n\nHistory:\n\n2014-04-16\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tInitial version.\n\n2014-04-18\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tReflects move to UTC time.\n\t\"Ping\" process
        has been split into a separate script.\n\n2014-04-24\t\t\n\tTim Dietrich (timdietrich@me.com)\n\tAdds
        support for the \"deletion\" phase of the sync process.\n\n2014-05-01\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tReflects new delete support strategy. \n\tIncludes
        call to \"Sync Check,\" code to clean up deleted record UUIDs, etc.\n\tAlso
        reflects move to a single \"EasySync_Payloads\" layout.\n\tRefresh Window
        script steps replaced with Refresh Object steps.\n\tMinor changes to UI and
        status messages.\n\n2014-05-15\t\n\tTim Dietrich (timdietrich@me.com)\n\tThe
        last pull UTC is now captured prior to the pull itself, and only gets set
        if the pull\n\tis successful. This prevents records that are in play on the
        servr while the payload is \n\tbeing processed on the mobile device from being
        excluded from future pulls.\n\n2014-10-19\n\tTim Dietrich (timdietrich@me.com)\n\tAdded
        configuration check. If no \"ES\" tables are setup, then the sync process
        is aborted."
      Text: "Sync With Server:\nManages the sync process.\n\nHistory:\n\n2014-04-16\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tInitial version.\n\n2014-04-18\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tReflects move to UTC time.\n\t\"Ping\" process
        has been split into a separate script.\n\n2014-04-24\t\t\n\tTim Dietrich (timdietrich@me.com)\n\tAdds
        support for the \"deletion\" phase of the sync process.\n\n2014-05-01\t\t\n\tTim
        Dietrich (timdietrich@me.com)\n\tReflects new delete support strategy. \n\tIncludes
        call to \"Sync Check,\" code to clean up deleted record UUIDs, etc.\n\tAlso
        reflects move to a single \"EasySync_Payloads\" layout.\n\tRefresh Window
        script steps replaced with Refresh Object steps.\n\tMinor changes to UI and
        status messages.\n\n2014-05-15\t\n\tTim Dietrich (timdietrich@me.com)\n\tThe
        last pull UTC is now captured prior to the pull itself, and only gets set
        if the pull\n\tis successful. This prevents records that are in play on the
        servr while the payload is \n\tbeing processed on the mobile device from being
        excluded from future pulls.\n\n2014-10-19\n\tTim Dietrich (timdietrich@me.com)\n\tAdded
        configuration check. If no \"ES\" tables are setup, then the sync process
        is aborted."
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Check to see if there are ES tables configured for syncing.'
      Text: Check to see if there are ES tables configured for syncing.
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $sync_tables; Value:ExecuteSQL ( "SELECT * FROM FileMaker_Tables
        WHERE ( TableName LIKE 'ES\_%' )"; "</col>"; ¶ ) ]
      Value:
        Calculation: ExecuteSQL ( "SELECT * FROM FileMaker_Tables WHERE ( TableName
          LIKE 'ES\_%' )"; "</col>"; ¶ )
        DisplayCalculation:
          Chunk:
          - ExecuteSQL
          - ' ( "SELECT * FROM FileMaker_Tables WHERE ( TableName LIKE ''ES\_%'' )";
            "</col>"; ¶ )'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $sync_tables
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ IsEmpty ( $sync_tables ) ]
      Calculation: IsEmpty ( $sync_tables )
      DisplayCalculation:
        Chunk:
        - IsEmpty
        - ' ( $sync_tables )'
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: 'Show Custom Dialog [ Title: "Configuration Error"; Message: "There
        are no \"ES\" tables configured for syncing."; Default Button: “OK”, Commit:
        “Yes” ]'
      Title:
        Calculation: '"Configuration Error"'
        DisplayCalculation:
          Chunk: '"Configuration Error"'
      Message:
        Calculation: '"There are no \"ES\" tables configured for syncing."'
        DisplayCalculation:
          Chunk: '"There are no \"ES\" tables configured for syncing."'
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"OK"'
          DisplayCalculation:
            Chunk: '"OK"'
        - CommitState: 'False'
        - CommitState: 'False'
    - enable: 'True'
      id: '90'
      name: Halt Script
      StepText: Halt Script
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Note the start time - both as a timestamp and UTC time.'
      Text: Note the start time - both as a timestamp and UTC time.
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $start; Value:Get ( CurrentTimeStamp ) ]
      Value:
        Calculation: Get ( CurrentTimeStamp )
        DisplayCalculation:
          Chunk:
          - Get
          - ' ( '
          - CurrentTimeStamp
          - ' )'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $start
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $start_utc; Value:Get ( CurrentTimeUTCMilliseconds
        ) ]
      Value:
        Calculation: Get ( CurrentTimeUTCMilliseconds )
        DisplayCalculation:
          Chunk:
          - Get
          - ' ( '
          - CurrentTimeUTCMilliseconds
          - ' )'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $start_utc
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '85'
      name: Allow User Abort
      StepText: Allow User Abort [ Off ]
      Set:
        state: 'False'
    - enable: 'True'
      id: '86'
      name: Set Error Capture
      StepText: Set Error Capture [ On ]
      Set:
        state: 'True'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Display EasySync layout.'
      Text: Display EasySync layout.
    - enable: 'True'
      id: '6'
      name: Go to Layout
      StepText: Go to Layout [ "EasySync_Payloads" ]
      LayoutDestination:
        value: LayoutNameByCalc
      Layout:
        Calculation: '"EasySync_Payloads"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads"'
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $$EasySync_Status; Value:"EasySync firing up..." ]
      Value:
        Calculation: '"EasySync firing up..."'
        DisplayCalculation:
          Chunk: '"EasySync firing up..."'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $$EasySync_Status
    - enable: 'True'
      id: '80'
      name: Refresh Window
      StepText: Refresh Window
      Option:
        state: 'False'
      FlushSQLData:
        state: 'False'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Load EasySync settings.'
      Text: Load EasySync settings.
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “EasySync Settings” ]
      Script:
        id: '29'
        name: EasySync Settings
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Ping the server.'
      Text: Ping the server.
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “Ping Server” ]
      Script:
        id: '32'
        name: Ping Server
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If the ping failed...'
      Text: If the ping failed...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ Get ( ScriptResult ) = 0 ]
      Calculation: Get ( ScriptResult ) = 0
      DisplayCalculation:
        Chunk:
        - Get
        - ' ( '
        - ScriptResult
        - ' ) = 0'
    - enable: 'True'
      id: '6'
      name: Go to Layout
      StepText: Go to Layout [ original layout ]
      LayoutDestination:
        value: OriginalLayout
    - enable: 'True'
      id: '103'
      name: Exit Script
      StepText: Exit Script [  ]
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Confirm the sync.'
      Text: Confirm the sync.
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ $$ask_before_sync ]
      Calculation: $$ask_before_sync
      DisplayCalculation:
        Chunk: $$ask_before_sync
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: 'Show Custom Dialog [ Title: "Sync With Server?"; Message: "Do you
        really want to sync with the server?"; Default Button: “Yes”, Commit: “Yes”;
        Button 2: “No”, Commit: “No” ]'
      Title:
        Calculation: '"Sync With Server?"'
        DisplayCalculation:
          Chunk: '"Sync With Server?"'
      Message:
        Calculation: '"Do you really want to sync with the server?"'
        DisplayCalculation:
          Chunk: '"Do you really want to sync with the server?"'
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"Yes"'
          DisplayCalculation:
            Chunk: '"Yes"'
        - CommitState: 'False'
          Calculation: '"No"'
          DisplayCalculation:
            Chunk: '"No"'
        - CommitState: 'False'
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ Get ( LastMessageChoice ) = 2 ]
      Calculation: Get ( LastMessageChoice ) = 2
      DisplayCalculation:
        Chunk:
        - Get
        - ' ( '
        - LastMessageChoice
        - ' ) = 2'
    - enable: 'True'
      id: '6'
      name: Go to Layout
      StepText: Go to Layout [ original layout ]
      LayoutDestination:
        value: OriginalLayout
    - enable: 'True'
      id: '103'
      name: Exit Script
      StepText: Exit Script [  ]
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $$EasySync_Status; Value:"Preparing to Sync..." ]
      Value:
        Calculation: '"Preparing to Sync..."'
        DisplayCalculation:
          Chunk: '"Preparing to Sync..."'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $$EasySync_Status
    - enable: 'True'
      id: '80'
      name: Refresh Window
      StepText: Refresh Window
      Option:
        state: 'False'
      FlushSQLData:
        state: 'False'
    - enable: 'False'
      id: '167'
      name: Refresh Object
      StepText: '//  Refresh Object [ Object Name: "easysync_status" ]'
      ObjectName:
        Calculation: '"easysync_status"'
        DisplayCalculation:
          Chunk: '"easysync_status"'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Commit any unsaved changes.'
      Text: Commit any unsaved changes.
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ $$commit_before_sync ]
      Calculation: $$commit_before_sync
      DisplayCalculation:
        Chunk: $$commit_before_sync
    - enable: 'True'
      id: '75'
      name: Commit Records/Requests
      StepText: |-
        Commit Records/Requests
        [ No dialog ]
      NoInteract:
        state: 'True'
      Option:
        state: 'False'
      ESSForceCommit:
        state: 'False'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Prevent the user from aborting, and we''ll handle errors, so suppress
        those...'
      Text: Prevent the user from aborting, and we'll handle errors, so suppress those...
    - enable: 'True'
      id: '68'
      name: If
      StepText: "If [ $$debug_push = 0 and $$debug_pull = 0 \n\n// Allow aborts in
        debug mode. ]"
      Calculation: "$$debug_push = 0 and $$debug_pull = 0 \n\n// Allow aborts in debug
        mode."
      DisplayCalculation:
        Chunk:
        - '$$debug_push = 0 '
        - and
        - " $$debug_pull = 0 \n\n"
        - // Allow aborts in debug mode.
    - enable: 'True'
      id: '85'
      name: Allow User Abort
      StepText: Allow User Abort [ Off ]
      Set:
        state: 'False'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '86'
      name: Set Error Capture
      StepText: Set Error Capture [ On ]
      Set:
        state: 'True'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $$EasySync_Status; Value:"EasySync is go for launch..."
        ]
      Value:
        Calculation: '"EasySync is go for launch..."'
        DisplayCalculation:
          Chunk: '"EasySync is go for launch..."'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $$EasySync_Status
    - enable: 'True'
      id: '80'
      name: Refresh Window
      StepText: Refresh Window
      Option:
        state: 'False'
      FlushSQLData:
        state: 'False'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If "ES_Last_Pull_UTC_Time" is not set...'
      Text: If "ES_Last_Pull_UTC_Time" is not set...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Pull_UTC_Time"
        ) ) ]
      Calculation: IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Pull_UTC_Time"
        ) )
      DisplayCalculation:
        Chunk:
        - IsEmpty
        - ' ( '
        - Evaluate
        - ' ( "EasySync_Payloads::ES_Last_Pull_UTC_Time" ) )'
    - enable: 'True'
      id: '147'
      name: Set Field By Name
      StepText: Set Field By Name [ "EasySync_Payloads::ES_Last_Pull_UTC_Time"; 0
        ]
      Result:
        Calculation: '0'
        DisplayCalculation:
          Chunk: '0'
      TargetName:
        Calculation: '"EasySync_Payloads::ES_Last_Pull_UTC_Time"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads::ES_Last_Pull_UTC_Time"'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If "ES_Last_Push_UTC_Time" is not set...'
      Text: If "ES_Last_Push_UTC_Time" is not set...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Push_UTC_Time"
        ) ) ]
      Calculation: IsEmpty ( Evaluate ( "EasySync_Payloads::ES_Last_Push_UTC_Time"
        ) )
      DisplayCalculation:
        Chunk:
        - IsEmpty
        - ' ( '
        - Evaluate
        - ' ( "EasySync_Payloads::ES_Last_Push_UTC_Time" ) )'
    - enable: 'True'
      id: '147'
      name: Set Field By Name
      StepText: Set Field By Name [ "EasySync_Payloads::ES_Last_Push_UTC_Time"; 0
        ]
      Result:
        Calculation: '0'
        DisplayCalculation:
          Chunk: '0'
      TargetName:
        Calculation: '"EasySync_Payloads::ES_Last_Push_UTC_Time"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads::ES_Last_Push_UTC_Time"'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Push data to the server.'
      Text: Push data to the server.
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “Push Payload” ]
      Script:
        id: '17'
        name: Push Payload
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If we are showing successful push info, or if there was an error...'
      Text: If we are showing successful push info, or if there was an error...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ ( $$show_successful_pushes = 1 ) or ( GetValue ( Get ( ScriptResult
        ) ; 1 ) ≠ 1 ) ]
      Calculation: ( $$show_successful_pushes = 1 ) or ( GetValue ( Get ( ScriptResult
        ) ; 1 ) ≠ 1 )
      DisplayCalculation:
        Chunk:
        - '( $$show_successful_pushes = 1 ) '
        - or
        - ' ( '
        - GetValue
        - ' ( '
        - Get
        - ' ( '
        - ScriptResult
        - ' ) ; 1 ) ≠ 1 )'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Show the push result to the user.'
      Text: Show the push result to the user.
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: 'Show Custom Dialog [ Title: GetValue ( Get ( ScriptResult ) ; 2 );
        Message: GetValue ( Get ( ScriptResult ) ; 3 ); Default Button: “OK”, Commit:
        “Yes” ]'
      Title:
        Calculation: GetValue ( Get ( ScriptResult ) ; 2 )
        DisplayCalculation:
          Chunk:
          - GetValue
          - ' ( '
          - Get
          - ' ( '
          - ScriptResult
          - ' ) ; 2 )'
      Message:
        Calculation: GetValue ( Get ( ScriptResult ) ; 3 )
        DisplayCalculation:
          Chunk:
          - GetValue
          - ' ( '
          - Get
          - ' ( '
          - ScriptResult
          - ' ) ; 3 )'
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"OK"'
          DisplayCalculation:
            Chunk: '"OK"'
        - CommitState: 'False'
        - CommitState: 'False'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If the push process was successful...'
      Text: If the push process was successful...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ]
      Calculation: GetValue ( Get ( ScriptResult ) ; 1 ) = 1
      DisplayCalculation:
        Chunk:
        - GetValue
        - ' ( '
        - Get
        - ' ( '
        - ScriptResult
        - ' ) ; 1 ) = 1'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If, during the ping process, it was found that the solution is out
        of date...'
      Text: If, during the ping process, it was found that the solution is out of
        date...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ $$easydeploy_suggest_upgrade ]
      Calculation: $$easydeploy_suggest_upgrade
      DisplayCalculation:
        Chunk: $$easydeploy_suggest_upgrade
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: 'Show Custom Dialog [ Title: "Upgrade Solution?"; Message: "A new
        version of this solution is available.¶¶Would you like to upgrade now?"; Default
        Button: “Yes”, Commit: “Yes”; Button 2: “No”, Commit: “No” ]'
      Title:
        Calculation: '"Upgrade Solution?"'
        DisplayCalculation:
          Chunk: '"Upgrade Solution?"'
      Message:
        Calculation: '"A new version of this solution is available.¶¶Would you like
          to upgrade now?"'
        DisplayCalculation:
          Chunk: '"A new version of this solution is available.¶¶Would you like to
            upgrade now?"'
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"Yes"'
          DisplayCalculation:
            Chunk: '"Yes"'
        - CommitState: 'False'
          Calculation: '"No"'
          DisplayCalculation:
            Chunk: '"No"'
        - CommitState: 'False'
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ Get ( LastMessageChoice ) = 1 ]
      Calculation: Get ( LastMessageChoice ) = 1
      DisplayCalculation:
        Chunk:
        - Get
        - ' ( '
        - LastMessageChoice
        - ' ) = 1'
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “Upgrade Solution” ]
      Script:
        id: '46'
        name: Upgrade Solution
    - enable: 'True'
      id: '90'
      name: Halt Script
      StepText: Halt Script
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Update the "last push" time.'
      Text: Update the "last push" time.
    - enable: 'True'
      id: '147'
      name: Set Field By Name
      StepText: Set Field By Name [ "EasySync_Payloads::ES_Last_Push_UTC_Time"; Get
        ( CurrentTimeUTCMilliseconds ) ]
      Result:
        Calculation: Get ( CurrentTimeUTCMilliseconds )
        DisplayCalculation:
          Chunk:
          - Get
          - ' ( '
          - CurrentTimeUTCMilliseconds
          - ' )'
      TargetName:
        Calculation: '"EasySync_Payloads::ES_Last_Push_UTC_Time"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads::ES_Last_Push_UTC_Time"'
    - enable: 'True'
      id: '75'
      name: Commit Records/Requests
      StepText: |-
        Commit Records/Requests
        [ Skip data entry validation; No dialog ]
      NoInteract:
        state: 'True'
      Option:
        state: 'True'
      ESSForceCommit:
        state: 'False'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Clean up any "deleted record UUID" payload records...'
      Text: Clean up any "deleted record UUID" payload records...
    - enable: 'True'
      id: '22'
      name: Enter Find Mode
      StepText: Enter Find Mode [  ]
      Pause:
        state: 'False'
      Restore:
        state: 'False'
    - enable: 'True'
      id: '76'
      name: Set Field
      StepText: Set Field [ EasySync_Payloads::ES_Deleted_Record_UUID; "@*" ]
      Calculation: '"@*"'
      DisplayCalculation:
        Chunk: '"@*"'
      Field:
        table: EasySync_Payloads
        id: '17'
        name: ES_Deleted_Record_UUID
    - enable: 'True'
      id: '28'
      name: Perform Find
      StepText: Perform Find [  ]
      Restore:
        state: 'False'
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ Get ( FoundCount ) ]
      Calculation: Get ( FoundCount )
      DisplayCalculation:
        Chunk:
        - Get
        - ' ( '
        - FoundCount
        - ' )'
    - enable: 'True'
      id: '10'
      name: Delete All Records
      StepText: |-
        Delete All Records
        [ No dialog ]
      NoInteract:
        state: 'True'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $$EasySync_Status; Value:"Pulling Data from Server..."
        ]
      Value:
        Calculation: '"Pulling Data from Server..."'
        DisplayCalculation:
          Chunk: '"Pulling Data from Server..."'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $$EasySync_Status
    - enable: 'True'
      id: '167'
      name: Refresh Object
      StepText: 'Refresh Object [ Object Name: "easysync_status" ]'
      ObjectName:
        Calculation: '"easysync_status"'
        DisplayCalculation:
          Chunk: '"easysync_status"'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Log the start of the pull process.'
      Text: Log the start of the pull process.
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $pull_start_utc; Value:Get ( CurrentTimeUTCMilliseconds
        ) ]
      Value:
        Calculation: Get ( CurrentTimeUTCMilliseconds )
        DisplayCalculation:
          Chunk:
          - Get
          - ' ( '
          - CurrentTimeUTCMilliseconds
          - ' )'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $pull_start_utc
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Pull data from the server.'
      Text: Pull data from the server.
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “Pull Payload” ]
      Script:
        id: '18'
        name: Pull Payload
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If the pull process was also successful...'
      Text: If the pull process was also successful...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ) ]
      Calculation: ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 )
      DisplayCalculation:
        Chunk:
        - '( '
        - GetValue
        - ' ( '
        - Get
        - ' ( '
        - ScriptResult
        - ' ) ; 1 ) = 1 )'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Update the "last pull" time.'
      Text: Update the "last pull" time.
    - enable: 'True'
      id: '147'
      name: Set Field By Name
      StepText: Set Field By Name [ "EasySync_Payloads::ES_Last_Pull_UTC_Time"; $pull_start_utc
        ]
      Result:
        Calculation: $pull_start_utc
        DisplayCalculation:
          Chunk: $pull_start_utc
      TargetName:
        Calculation: '"EasySync_Payloads::ES_Last_Pull_UTC_Time"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads::ES_Last_Pull_UTC_Time"'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Set a timestamp as well, for use by the UI to show the "last sync."'
      Text: Set a timestamp as well, for use by the UI to show the "last sync."
    - enable: 'True'
      id: '147'
      name: Set Field By Name
      StepText: Set Field By Name [ "EasySync_Payloads::ES_Last_Full_Sync"; Get (
        CurrentTimeStamp ) ]
      Result:
        Calculation: Get ( CurrentTimeStamp )
        DisplayCalculation:
          Chunk:
          - Get
          - ' ( '
          - CurrentTimeStamp
          - ' )'
      TargetName:
        Calculation: '"EasySync_Payloads::ES_Last_Full_Sync"'
        DisplayCalculation:
          Chunk: '"EasySync_Payloads::ES_Last_Full_Sync"'
    - enable: 'True'
      id: '75'
      name: Commit Records/Requests
      StepText: |-
        Commit Records/Requests
        [ Skip data entry validation; No dialog ]
      NoInteract:
        state: 'True'
      Option:
        state: 'True'
      ESSForceCommit:
        state: 'False'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Show the pull result to the user.'
      Text: Show the pull result to the user.
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ ( $$show_successful_pulls = 1 ) or ( GetValue ( Get ( ScriptResult
        ) ; 1 ) = 0 ) ]
      Calculation: ( $$show_successful_pulls = 1 ) or ( GetValue ( Get ( ScriptResult
        ) ; 1 ) = 0 )
      DisplayCalculation:
        Chunk:
        - '( $$show_successful_pulls = 1 ) '
        - or
        - ' ( '
        - GetValue
        - ' ( '
        - Get
        - ' ( '
        - ScriptResult
        - ' ) ; 1 ) = 0 )'
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: 'Show Custom Dialog [ Title: GetValue ( Get ( ScriptResult ) ; 2 );
        Message: GetValue ( Get ( ScriptResult ) ; 3 ); Default Button: “OK”, Commit:
        “Yes” ]'
      Title:
        Calculation: GetValue ( Get ( ScriptResult ) ; 2 )
        DisplayCalculation:
          Chunk:
          - GetValue
          - ' ( '
          - Get
          - ' ( '
          - ScriptResult
          - ' ) ; 2 )'
      Message:
        Calculation: GetValue ( Get ( ScriptResult ) ; 3 )
        DisplayCalculation:
          Chunk:
          - GetValue
          - ' ( '
          - Get
          - ' ( '
          - ScriptResult
          - ' ) ; 3 )'
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"OK"'
          DisplayCalculation:
            Chunk: '"OK"'
        - CommitState: 'False'
        - CommitState: 'False'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#If the pull was successful, and if we are to perform a sync check...'
      Text: If the pull was successful, and if we are to perform a sync check...
    - enable: 'True'
      id: '68'
      name: If
      StepText: If [ ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ) and $$perform_sync_check
        ]
      Calculation: ( GetValue ( Get ( ScriptResult ) ; 1 ) = 1 ) and $$perform_sync_check
      DisplayCalculation:
        Chunk:
        - '( '
        - GetValue
        - ' ( '
        - Get
        - ' ( '
        - ScriptResult
        - ' ) ; 1 ) = 1 ) '
        - and
        - ' $$perform_sync_check'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Peform a "sync check" to delete any records on the mobile device
        that are no longer on the server.'
      Text: Peform a "sync check" to delete any records on the mobile device that
        are no longer on the server.
    - enable: 'True'
      id: '1'
      name: Perform Script
      StepText: Perform Script [ “Sync Check” ]
      Script:
        id: '45'
        name: Sync Check
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Refresh UI.'
      Text: Refresh UI.
    - enable: 'True'
      id: '6'
      name: Go to Layout
      StepText: Go to Layout [ original layout ]
      LayoutDestination:
        value: OriginalLayout
      Layout:
        id: '0'
        name: ''
        Calculation: '"EasySync_Status"'
        DisplayCalculation:
          Chunk: '"EasySync_Status"'
    - enable: 'True'
      id: '23'
      name: Show All Records
      StepText: Show All Records
    - enable: 'True'
      id: '80'
      name: Refresh Window
      StepText: Refresh Window
      Option:
        state: 'False'
      FlushSQLData:
        state: 'False'
    - enable: 'True'
      id: '141'
      name: Set Variable
      StepText: Set Variable [ $$EasySync_Status; Value:"" ]
      Value:
        Calculation: '""'
        DisplayCalculation:
          Chunk: '""'
      Repetition:
        Calculation: '1'
        DisplayCalculation:
          Chunk: '1'
      Name: $$EasySync_Status
    - enable: 'True'
      id: '87'
      name: Show Custom Dialog
      StepText: |-
        Show Custom Dialog [ Title: "Sync Completed"; Message: Let (
        [
        e = Get ( CurrentTimeStamp ) - $start;
        e = If ( e ≤ 1 ; "Less than a second."; e )
        ];
        "The sync process has completed. (Elapsed Time: " & e & ")"
        ); Default Button: “OK”, Commit: “Yes” ]
      Title:
        Calculation: '"Sync Completed"'
        DisplayCalculation:
          Chunk: '"Sync Completed"'
      Message:
        Calculation: |-
          Let (
          [
          e = Get ( CurrentTimeStamp ) - $start;
          e = If ( e ≤ 1 ; "Less than a second."; e )
          ];
          "The sync process has completed. (Elapsed Time: " & e & ")"
          )
        DisplayCalculation:
          Chunk:
          - Let
          - " (\n[\ne = "
          - Get
          - ' ( '
          - CurrentTimeStamp
          - " ) - $start;\ne = "
          - If
          - |2-
             ( e ≤ 1 ; "Less than a second."; e )
            ];
            "The sync process has completed. (Elapsed Time: " & e & ")"
            )
      Buttons:
        Button:
        - CommitState: 'True'
          Calculation: '"OK"'
          DisplayCalculation:
            Chunk: '"OK"'
        - CommitState: 'False'
        - CommitState: 'False'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '69'
      name: Else
      StepText: Else
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#Close the hosted file.'
      Text: Close the hosted file.
    - enable: 'True'
      id: '34'
      name: Close File
      StepText: Close File [ “Hosted_Database” ]
      FileReference:
        id: '1'
        name: Hosted_Database
        UniversalPathList: |-
          fmnet:/your-server-address/FM_Surveys_Hosted
          file:FM_Surveys_Hosted
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '6'
      name: Go to Layout
      StepText: Go to Layout [ original layout ]
      LayoutDestination:
        value: OriginalLayout
      Layout:
        Calculation: '"EasySync_Status"'
        DisplayCalculation:
          Chunk: '"EasySync_Status"'
    - enable: 'True'
      id: '89'
      name: Comment
      StepText: '#'
    - enable: 'True'
      id: '70'
      name: End If
      StepText: End If
